# RepliBuild Examples

This directory contains **real, working examples** that prove RepliBuild works.

## ðŸ“š Example Index

### [01_simple_math.md](01_simple_math.md)
**Simplest possible usage** - Wrap basic C functions
- â±ï¸ **5 minutes**
- ðŸŽ¯ **Zero boilerplate**
- âœ… **Type-safe ccall wrappers**

```cpp
extern "C" int add(int a, int b) { return a + b; }
```
```julia
result = add(5, 3)  # 8
```

---

### [02_structs_and_classes.md](02_structs_and_classes.md)
**DWARF extraction in action** - Auto-generate Julia structs from C++
- â±ï¸ **10 minutes**
- ðŸŽ¯ **Automatic struct definitions**
- âœ… **ABI-accurate types from DWARF**

```cpp
struct Point { double x, y; };
```
```julia
mutable struct Point  # Auto-generated!
    x::Cdouble
    y::Cdouble
end
```

---

### [StructTest.jl](StructTest.jl)
**Real generated wrapper** - Actual RepliBuild output you can inspect

This is a **real file** generated by RepliBuild showing:
- âœ… DWARF-extracted struct definition
- âœ… Complete function wrappers with docs
- âœ… Metadata from compilation
- âœ… Type-safe ccall signatures

**Try it:**
```julia
include("docs/examples/StructTest.jl")
using .StructTest

p1 = create_point(1.0, 2.0)
p2 = create_point(4.0, 6.0)
p3 = add_points(p1, p2)  # Point(5.0, 8.0)
```

---

## ðŸš€ Quick Start

**Pick an example:**

1. **New to RepliBuild?** â†’ Start with `01_simple_math.md`
2. **Want to see DWARF extraction?** â†’ Check `02_structs_and_classes.md`
3. **Want to see real output?** â†’ Inspect `StructTest.jl`

**Run an example:**

```bash
# Copy any example to your project
cd your_cpp_project/

# Create config (or use example's)
cat > replibuild.toml << EOF
[project]
name = "mylib"
root = "."

[compile]
source_files = ["mycode.cpp"]
flags = ["-std=c++17", "-fPIC", "-g"]

[binary]
type = "library"
EOF

# Build + wrap
julia -e 'using RepliBuild; RepliBuild.build(); RepliBuild.wrap()'
```

---

## ðŸ“Š What Each Example Teaches

| Example | Teaches | Time | Difficulty |
|---------|---------|------|------------|
| **01_simple_math** | Basic workflow | 5 min | Easy |
| **02_structs** | DWARF extraction | 10 min | Medium |
| **StructTest.jl** | Real output inspection | 2 min | Easy |

---

## ðŸŽ¯ Key Concepts Demonstrated

### 1. Zero Boilerplate
No manual wrapper writing - just compile and wrap:
```julia
RepliBuild.build()  # C++ â†’ library
RepliBuild.wrap()   # library â†’ Julia
```

### 2. DWARF Extraction
Automatic struct generation from C++ debug info:
```
C++ struct â†’ DWARF DIE â†’ Julia mutable struct
```

### 3. Three-Way Validation
DWARF + LLVM IR + Symbol tables ensure correctness:
```
DWARF: "Point has x::double, y::double"
LLVM IR: "Point is 16 bytes"
Symbols: "add_points takes Point, Point"
â†’ All match âœ… Safe to wrap!
```

### 4. Type Safety
Types extracted from compilation, not guessed:
```julia
# RepliBuild knows:
x::Cdouble  # Not Float32! DWARF told us.
```

---

## ðŸ”¬ Advanced: Understanding Generated Code

### Anatomy of a Wrapper

```julia
module MyLib                           # Auto-generated module

using Libdl                            # For dynamic loading

const LIBRARY_PATH = "julia/lib.so"    # Path to compiled library

# Struct from DWARF (if -g flag used)
mutable struct Point
    x::Cdouble
    y::Cdouble
end

# Function wrapper
function add(a::Cint, b::Cint)::Cint
    ccall((:add, LIBRARY_PATH),        # Symbol from library
          Cint,                         # Return type
          (Cint, Cint),                 # Argument types
          a, b)                         # Arguments
end

end # module
```

### What RepliBuild Did

1. **Compiled** your C++ with `-g` flag
2. **Extracted** DWARF debug information (structs, types)
3. **Parsed** LLVM IR (ABI layout verification)
4. **Read** symbol table (function names, linkage)
5. **Cross-validated** all three sources
6. **Generated** type-safe Julia module

---

## ðŸ’¡ Tips for Your Projects

### âœ… Do This
- Use `-g` flag for DWARF extraction
- Keep structs simple (POD types)
- Use `extern "C"` for C++ functions
- Check `info()` to see what's built

### âŒ Avoid This
- Virtual methods (not supported)
- Inheritance (not supported)
- STL containers (ABI-unstable)
- Templates without ODR use

See [LIMITATIONS.md](../../LIMITATIONS.md) for complete list.

---

## ðŸ› Troubleshooting

**"No library found"**
â†’ Run `RepliBuild.build()` first

**"No metadata found"**
â†’ Add `-g` flag to compile.flags in config

**"Library loads but functions crash"**
â†’ Check you're using standard-layout types only

**Need help?**
â†’ File an issue: https://github.com/obsidianjulua/RepliBuild.jl/issues

---

## ðŸ“– More Documentation

- [USAGE.md](../../USAGE.md) - Complete usage guide
- [LIMITATIONS.md](../../LIMITATIONS.md) - What's supported/not
- [ARCHITECTURE.md](../../ARCHITECTURE.md) - How it works
- [README.md](../../README.md) - Main documentation

---

## ðŸŽ“ Learning Path

1. **Start:** Read `01_simple_math.md` (5 min)
2. **Explore:** Try `02_structs_and_classes.md` (10 min)
3. **Inspect:** Look at `StructTest.jl` (real output)
4. **Build:** Try with your own C++ code!
5. **Learn:** Read ARCHITECTURE.md if curious about DWARF

**Total time to proficiency: ~30 minutes** âš¡

---

## ðŸš€ Ready to Use RepliBuild?

```bash
# Install (after registration)
julia> using Pkg; Pkg.add("RepliBuild")

# Or use from source
julia> using Pkg; Pkg.develop(path="/path/to/RepliBuild.jl")
```

**Happy wrapping! ðŸŽ‰**
